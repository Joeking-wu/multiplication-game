<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注音符號聽力遊戲</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 引入 Nunito 字體 */
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f9ff;
            min-height: 100vh;
        }

        /* 注音符號卡片樣式與動畫 */
        .symbol-card {
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
        }

            .symbol-card:hover {
                transform: translateY(-5px);
            }

            .symbol-card.correct {
                background-color: #86efac !important;
                animation: bounce 0.5s;
            }

            .symbol-card.incorrect {
                background-color: #fca5a5 !important;
                animation: shake 0.5s;
            }

        /* 彈跳動畫 */
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        /* 晃動動畫 */
        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        /* 進度條樣式 */
        .progress-bar {
            transition: width 0.5s ease;
        }

        /* 星星樣式 */
        .star {
            display: inline-block;
            opacity: 0.3;
            transition: all 0.3s ease;
        }

            .star.earned {
                opacity: 1;
                transform: scale(1.2);
            }

        /* 五彩紙屑樣式與動畫 */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }

        /* 紙屑下落動畫 */
        @keyframes fall {
            0% {
                transform: translateY(-100px);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        /* 關卡按鈕樣式 */
        .level-button {
            transition: all 0.3s ease;
        }

            .level-button:hover:not(.locked) {
                transform: scale(1.05);
            }

        .locked {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* 角色容器 */
        .character-container {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .character {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.5s ease;
        }

        /* 角色對話框樣式 */
        .speech-bubble {
            position: absolute;
            background-color: white;
            border-radius: 20px;
            padding: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s ease;
            width: 120px;
            text-align: center;
        }

            .speech-bubble:after {
                content: '';
                position: absolute;
                bottom: -10px;
                left: 50%;
                transform: translateX(-50%);
                border-width: 10px 10px 0;
                border-style: solid;
                border-color: white transparent transparent;
            }

        /* 聲波動畫 */
        .sound-wave {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 60px;
        }

            .sound-wave span {
                display: inline-block;
                width: 6px;
                height: 30px;
                margin: 0 2px;
                background-color: #6366f1;
                border-radius: 3px;
                animation: sound-wave 1s infinite ease-in-out;
            }

                .sound-wave span:nth-child(2) {
                    animation-delay: 0.1s;
                }

                .sound-wave span:nth-child(3) {
                    animation-delay: 0.2s;
                }

                .sound-wave span:nth-child(4) {
                    animation-delay: 0.3s;
                }

                .sound-wave span:nth-child(5) {
                    animation-delay: 0.4s;
                }

        @keyframes sound-wave {
            0%, 100% {
                height: 10px;
            }

            50% {
                height: 40px;
            }
        }

        /* 播放按鈕的漣漪效果 */
        .sound-button {
            position: relative;
            overflow: hidden;
        }

            .sound-button:after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 5px;
                height: 5px;
                background: rgba(255, 255, 255, 0.5);
                opacity: 0;
                border-radius: 100%;
                transform: scale(1, 1) translate(-50%);
                transform-origin: 50% 50%;
            }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }

            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        .sound-button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        /* 嘴巴動畫 */
        .mouth {
            transition: all 0.3s ease;
        }

            .mouth.speaking {
                animation: speak 0.5s infinite alternate;
            }

        @keyframes speak {
            0% {
                transform: scaleY(0.5);
            }

            100% {
                transform: scaleY(1);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-b from-blue-100 to-purple-100">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-700 mb-2">注音符號聽力遊戲</h1>
            <p class="text-lg text-indigo-600">小學一年級注音符號學習遊戲</p>
        </div>

        <div id="game-container" class="bg-white rounded-2xl shadow-xl p-6 relative overflow-hidden">
            <div id="start-screen" class="text-center py-10">
                <div class="mb-8">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" class="w-40 h-40 mx-auto">
                        <circle cx="100" cy="90" r="70" fill="#FFD1D1" />
                        <circle cx="70" cy="80" r="10" fill="#333" />
                        <circle cx="130" cy="80" r="10" fill="#333" />
                        <path d="M70 120c10 20 50 20 60 0" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round" class="mouth" />
                        <path d="M40 50 C 50 30, 70 20, 100 20 C 130 20, 150 30, 160 50" stroke="#FF9999" stroke-width="5" fill="none" stroke-linecap="round" />
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-indigo-800 mb-6">歡迎來到注音符號聽力遊戲！</h2>
                <p class="text-lg text-gray-700 mb-8">聽一聽，選一選，學習注音符號吧！</p>
                <button id="start-button" class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white text-xl font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                    開始遊戲
                </button>
            </div>

            <div id="level-select" class="hidden">
                <h2 class="text-2xl font-bold text-indigo-800 mb-6 text-center">選擇關卡</h2>

                <div class="character-container mx-auto mb-6">
                    <div class="character">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="w-24 h-24">
                            <circle cx="50" cy="40" r="30" fill="#FFD1D1" />
                            <circle cx="40" cy="35" r="5" fill="#333" />
                            <circle cx="60" cy="35" r="5" fill="#333" />
                            <path d="M40 50c5 8 20 8 25 0" stroke="#333" stroke-width="2" fill="none" stroke-linecap="round" class="mouth" />
                        </svg>
                        <div class="speech-bubble" id="guide-speech">選擇一個關卡開始吧！</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                    <div class="level-button bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl p-4 shadow-md text-center cursor-pointer" data-level="1">
                        <div class="text-3xl mb-2">🎧</div>
                        <h3 class="font-bold text-blue-800">第一關</h3>
                        <p class="text-sm text-blue-700">ㄅㄆㄇㄈ</p>
                        <div class="mt-2 flex justify-center">
                            <span class="star earned text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                        </div>
                    </div>

                    <div class="level-button bg-gradient-to-br from-green-100 to-green-200 rounded-xl p-4 shadow-md text-center cursor-pointer" data-level="2">
                        <div class="text-3xl mb-2">🎧</div>
                        <h3 class="font-bold text-green-800">第二關</h3>
                        <p class="text-sm text-green-700">ㄉㄊㄋㄌ</p>
                        <div class="mt-2 flex justify-center">
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                        </div>
                    </div>

                    <div class="level-button bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl p-4 shadow-md text-center cursor-pointer" data-level="3">
                        <div class="text-3xl mb-2">🎧</div>
                        <h3 class="font-bold text-purple-800">第三關</h3>
                        <p class="text-sm text-purple-700">ㄍㄎㄏ</p>
                        <div class="mt-2 flex justify-center">
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                        </div>
                    </div>

                    <div class="level-button locked bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl p-4 shadow-md text-center" data-level="4">
                        <div class="text-3xl mb-2">🔒</div>
                        <h3 class="font-bold text-gray-800">第四關</h3>
                        <p class="text-sm text-gray-700">ㄐㄑㄒ</p>
                        <div class="mt-2 flex justify-center">
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                        </div>
                    </div>

                    <div class="level-button locked bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl p-4 shadow-md text-center" data-level="5">
                        <div class="text-3xl mb-2">🔒</div>
                        <h3 class="font-bold text-gray-800">第五關</h3>
                        <p class="text-sm text-gray-700">ㄓㄔㄕㄖ</p>
                        <div class="mt-2 flex justify-center">
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                        </div>
                    </div>

                    <div class="level-button locked bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl p-4 shadow-md text-center" data-level="6">
                        <div class="text-3xl mb-2">🔒</div>
                        <h3 class="font-bold text-gray-800">第六關</h3>
                        <p class="text-sm text-gray-700">ㄗㄘㄙ</p>
                        <div class="mt-2 flex justify-center">
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                        </div>
                    </div>

                    <div class="level-button locked bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl p-4 shadow-md text-center" data-level="7">
                        <div class="text-3xl mb-2">🔒</div>
                        <h3 class="font-bold text-gray-800">第七關</h3>
                        <p class="text-sm text-gray-700">ㄚㄛㄜ</p>
                        <div class="mt-2 flex justify-center">
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                        </div>
                    </div>

                    <div class="level-button locked bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl p-4 shadow-md text-center" data-level="8">
                        <div class="text-3xl mb-2">🔒</div>
                        <h3 class="font-bold text-gray-800">第八關</h3>
                        <p class="text-sm text-gray-700">ㄝㄞㄟㄠㄡ</p>
                        <div class="mt-2 flex justify-center">
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                        </div>
                    </div>

                    <div class="level-button locked bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl p-4 shadow-md text-center" data-level="9">
                        <div class="text-3xl mb-2">🔒</div>
                        <h3 class="font-bold text-gray-800">第九關</h3>
                        <p class="text-sm text-gray-700">ㄢㄣㄤㄥㄦㄧㄨㄩ</p>
                        <div class="mt-2 flex justify-center">
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                            <span class="star text-yellow-400 text-xl">★</span>
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <button id="back-to-start" class="bg-gray-200 text-gray-700 font-bold py-2 px-6 rounded-full hover:bg-gray-300 transition-all duration-300">
                        返回首頁
                    </button>
                </div>
            </div>

            <div id="game-screen" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <button id="back-to-levels" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-full hover:bg-gray-300 transition-all duration-300 flex items-center">
                        <span class="mr-1">←</span> 返回
                    </button>
                    <div class="text-center">
                        <h2 id="level-title" class="text-xl font-bold text-indigo-800">第一關：ㄅㄆㄇㄈ</h2>
                        <div class="flex justify-center mt-1">
                            <div id="level-stars" class="flex">
                                <span class="star text-yellow-400 text-xl mx-1">★</span>
                                <span class="star text-yellow-400 text-xl mx-1">★</span>
                                <span class="star text-yellow-400 text-xl mx-1">★</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-200 rounded-full px-4 py-2">
                        <span id="score-display" class="font-bold text-indigo-800">0</span>
                        <span class="text-indigo-800">分</span>
                    </div>
                </div>

                <div class="w-full bg-gray-200 rounded-full h-4 mb-6">
                    <div id="progress-bar" class="bg-gradient-to-r from-green-400 to-blue-500 h-4 rounded-full progress-bar" style="width: 0%"></div>
                </div>

                <div class="mb-8">
                    <div class="text-center mb-4">
                        <h3 class="text-lg text-gray-700">請聽發音，選出正確的注音符號：</h3>
                    </div>
                    <div id="question-display" class="bg-indigo-100 rounded-xl p-6 text-center">
                        <div class="flex justify-center items-center mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="w-20 h-20">
                                <circle cx="50" cy="50" r="40" fill="#FFD1D1" />
                                <circle cx="35" cy="40" r="6" fill="#333" />
                                <circle cx="65" cy="40" r="6" fill="#333" />
                                <path d="M35 65c5 10 25 10 30 0" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round" id="character-mouth" class="mouth" />
                            </svg>
                        </div>

                        <button id="play-sound" class="sound-button bg-indigo-600 text-white font-bold py-3 px-6 rounded-full hover:bg-indigo-700 transition-all duration-300 flex items-center mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                            </svg>
                            播放發音
                        </button>

                        <div id="sound-wave" class="sound-wave hidden mb-4">
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>

                        <div id="current-symbol" class="hidden">
                            <span class="text-5xl font-bold text-indigo-800">?</span>
                        </div>
                    </div>
                </div>

                <div id="options-container" class="grid grid-cols-2 gap-4">
                    </div>

                <div id="feedback-area" class="mt-6 text-center hidden">
                    <div id="correct-feedback" class="bg-green-100 text-green-800 p-4 rounded-xl hidden">
                        <p class="text-xl font-bold">太棒了！答對了！</p>
                        <p>繼續保持！</p>
                    </div>
                    <div id="incorrect-feedback" class="bg-red-100 text-red-800 p-4 rounded-xl hidden">
                        <p class="text-xl font-bold">再試一次！</p>
                        <p>正確答案是：<span id="correct-answer" class="font-bold"></span></p>
                    </div>
                </div>
            </div>

            <div id="level-complete" class="hidden text-center py-10">
                <div class="mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" class="w-32 h-32 mx-auto">
                        <circle cx="100" cy="90" r="70" fill="#FFD1D1" />
                        <circle cx="70" cy="80" r="10" fill="#333" />
                        <circle cx="130" cy="80" r="10" fill="#333" />
                        <path d="M70 120c10 20 50 20 60 0" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round" />
                        <path d="M40 50 C 50 30, 70 20, 100 20 C 130 20, 150 30, 160 50" stroke="#FF9999" stroke-width="5" fill="none" stroke-linecap="round" />
                    </svg>
                </div>
                <h2 class="text-3xl font-bold text-indigo-800 mb-4">恭喜完成關卡！</h2>
                <div class="flex justify-center mb-6">
                    <div id="result-stars" class="flex">
                        <span class="star text-yellow-400 text-3xl mx-2">★</span>
                        <span class="star text-yellow-400 text-3xl mx-2">★</span>
                        <span class="star text-yellow-400 text-3xl mx-2">★</span>
                    </div>
                </div>
                <p id="final-score" class="text-xl text-gray-700 mb-8">你獲得了 <span class="font-bold text-indigo-700">0</span> 分！</p>
                <div class="flex justify-center space-x-4">
                    <button id="replay-level" class="bg-indigo-500 text-white font-bold py-3 px-6 rounded-full hover:bg-indigo-600 transition-all duration-300">
                        再玩一次
                    </button>
                    <button id="next-level" class="bg-gradient-to-r from-green-500 to-blue-500 text-white font-bold py-3 px-6 rounded-full hover:shadow-lg transition-all duration-300">
                        下一關
                    </button>
                </div>
            </div>
        </div>

        <div class="mt-6 text-center text-gray-600">
            <p>注音符號聽力遊戲 BY JOE</p>
        </div>
    </div>

    <audio id="c_01" src="assets/sounds/F1.wav" preload="auto"></audio><!- ㄅ-->
    <audio id="c_02" src="assets/sounds/F2.wav" preload="auto"></audio><!- ㄆ-->
    <audio id="c_03" src="assets/sounds/F3.wav" preload="auto"></audio><!- ㄇ-->
    <audio id="c_04" src="assets/sounds/F4.wav" preload="auto"></audio><!- ㄈ-->
    <audio id="c_05" src="assets/sounds/F5.wav" preload="auto"></audio><!- ㄉ-->
    <audio id="c_06" src="assets/sounds/F6.wav" preload="auto"></audio><!- ㄊ-->
    <audio id="c_07" src="assets/sounds/F7.wav" preload="auto"></audio><!- ㄋ-->
    <audio id="c_08" src="assets/sounds/F8.wav" preload="auto"></audio><!- ㄌ-->
    <audio id="c_09" src="assets/sounds/F9.wav" preload="auto"></audio><!- ㄍ-->

    <audio id="c_10" src="assets/sounds/F10.wav" preload="auto"></audio><!- ㄎ-->
    <audio id="c_11" src="assets/sounds/F11.wav" preload="auto"></audio><!- ㄏ-->
    <audio id="c_12" src="assets/sounds/F12.wav" preload="auto"></audio><!- ㄐ-->
    <audio id="c_13" src="assets/sounds/F13.wav" preload="auto"></audio><!- ㄑ-->
    <audio id="c_14" src="assets/sounds/F14.wav" preload="auto"></audio><!- ㄒ-->
    <audio id="c_15" src="assets/sounds/F15.wav" preload="auto"></audio><!- ㄓ-->
    <audio id="c_16" src="assets/sounds/F16.wav" preload="auto"></audio><!- ㄔ-->
    <audio id="c_17" src="assets/sounds/F17.wav" preload="auto"></audio><!- ㄕ-->
    <audio id="c_18" src="assets/sounds/F18.wav" preload="auto"></audio><!- ㄖ-->
    <audio id="c_19" src="assets/sounds/F19.wav" preload="auto"></audio><!- ㄗ-->

    <audio id="c_20" src="assets/sounds/F20.wav" preload="auto"></audio><!- ㄘ-->
    <audio id="c_21" src="assets/sounds/F21.wav" preload="auto"></audio><!- ㄙ-->
    <audio id="c_22" src="assets/sounds/F22.wav" preload="auto"></audio><!- ㄚ-->
    <audio id="c_23" src="assets/sounds/F23.wav" preload="auto"></audio><!- ㄛ-->
    <audio id="c_24" src="assets/sounds/F24.wav" preload="auto"></audio><!- ㄜ-->
    <audio id="c_25" src="assets/sounds/F25.wav" preload="auto"></audio><!- ㄝ-->
    <audio id="c_26" src="assets/sounds/F26.wav" preload="auto"></audio><!- ㄞ-->
    <audio id="c_27" src="assets/sounds/F27.wav" preload="auto"></audio><!- ㄟ-->
    <audio id="c_28" src="assets/sounds/F28.wav" preload="auto"></audio><!- ㄠ-->
    <audio id="c_29" src="assets/sounds/F29.wav" preload="auto"></audio><!- ㄡ-->

    <audio id="c_30" src="assets/sounds/F30.wav" preload="auto"></audio><!- ㄢ-->
    <audio id="c_31" src="assets/sounds/F31.wav" preload="auto"></audio><!- ㄣ-->
    <audio id="c_32" src="assets/sounds/F32.wav" preload="auto"></audio><!- ㄤ-->
    <audio id="c_33" src="assets/sounds/F33.wav" preload="auto"></audio><!- ㄥ-->
    <audio id="c_34" src="assets/sounds/F34.wav" preload="auto"></audio><!- ㄦ-->
    <audio id="c_35" src="assets/sounds/F35.wav" preload="auto"></audio><!- ㄧ-->
    <audio id="c_36" src="assets/sounds/F36.wav" preload="auto"></audio><!- ㄨ-->
    <audio id="c_37" src="assets/sounds/F37.wav" preload="auto"></audio><!- ㄩ-->

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // ==========================================
            //  遊戲狀態與數據
            // ==========================================
            const gameState = {
                currentLevel: 1,           // 目前關卡編號
                score: 0,                  // 玩家分數
                progress: 0,               // 關卡進度（0-100%）
                totalQuestions: 10,        // 每關總問題數
                currentQuestion: 0,        // 目前問題索引
                correctAnswers: 0,         // 正確答題數
                stars: 0,                  // 獲得的星星數
                currentSymbol: null,       // 當前問題的正確注音符號
                isPlaying: false,          // 聲音是否正在播放
                levels: {                  // 關卡資料配置
                    1: {
                        title: "第一關：ㄅㄆㄇㄈ",
                        symbols: ["ㄅ", "ㄆ", "ㄇ", "ㄈ"],
                        symbolsA: ["c_01", "c_02", "c_03", "c_04"],
                        words: {
                            "ㄅ": ["爸", "杯", "布", "比"],
                            "ㄆ": ["拍", "跑", "碰", "泡"],
                            "ㄇ": ["媽", "買", "米", "帽"],
                            "ㄈ": ["發", "飛", "方", "放"]
                        },
                        unlocked: true,    // 預設第一關解鎖
                        completed: false,
                        stars: 0
                    },
                    2: {
                        title: "第二關：ㄉㄊㄋㄌ",
                        symbols: ["ㄉ", "ㄊ", "ㄋ", "ㄌ"],
                        symbolsA: ["c_05", "c_06", "c_07", "c_08"],
                        words: {
                            "ㄉ": ["大", "電", "點", "弟"],
                            "ㄊ": ["他", "天", "跳", "聽"],
                            "ㄋ": ["你", "奶", "年", "鳥"],
                            "ㄌ": ["來", "了", "路", "藍"]
                        },
                        unlocked: true,
                        completed: false,
                        stars: 0
                    },
                    3: {
                        title: "第三關：ㄍㄎㄏ",
                        symbols: ["ㄍ", "ㄎ", "ㄏ"],
                        symbolsA: ["c_09", "c_10", "c_11"],
                        words: {
                            "ㄍ": ["哥", "狗", "高", "果"],
                            "ㄎ": ["開", "看", "口", "快"],
                            "ㄏ": ["好", "喝", "花", "火"]
                        },
                        unlocked: true,
                        completed: false,
                        stars: 0
                    },
                    4: {
                        title: "第四關：ㄐㄑㄒ",
                        symbols: ["ㄐ", "ㄑ", "ㄒ"],
                        symbolsA: ["c_12", "c_13", "c_14"],
                        words: {
                            "ㄐ": ["家", "雞", "見", "叫"],
                            "ㄑ": ["去", "氣", "前", "親"],
                            "ㄒ": ["下", "小", "學", "心"]
                        },
                        unlocked: false,   // 預設第四關未解鎖
                        completed: false,
                        stars: 0
                    },
                    5: {
                        title: "第五關：ㄓㄔㄕㄖ",
                        symbols: ["ㄓ", "ㄔ", "ㄕ", "ㄖ"],
                        symbolsA: ["c_15", "c_16", "c_17", "c_18"],
                        words: {
                            "ㄓ": ["知", "豬", "紙", "中"],
                            "ㄔ": ["吃", "出", "車", "長"],
                            "ㄕ": ["是", "時", "書", "山"],
                            "ㄖ": ["日", "肉", "熱", "人"]
                        },
                        unlocked: false,
                        completed: false,
                        stars: 0
                    },
                    6: {
                        title: "第六關：ㄗㄘㄙ",
                        symbols: ["ㄗ", "ㄘ", "ㄙ"],
                        symbolsA: ["c_19", "c_20", "c_21"],
                        words: {
                            "ㄗ": ["字", "自", "走", "坐"],
                            "ㄘ": ["從", "菜", "草", "次"],
                            "ㄙ": ["四", "三", "送", "絲"]
                        },
                        unlocked: false,
                        completed: false,
                        stars: 0
                    },
                    7: {
                        title: "第七關：ㄚㄛㄜ",
                        symbols: ["ㄚ", "ㄛ", "ㄜ"],
                        symbolsA: ["c_22", "c_23", "c_24"],
                        words: {
                            "ㄚ": ["字", "自", "走", "坐"],
                            "ㄛ": ["從", "菜", "草", "次"],
                            "ㄜ": ["四", "三", "送", "絲"]
                        },
                        unlocked: false,
                        completed: false,
                        stars: 0
                    },
                    8: {
                        title: "第八關：ㄝㄞㄟㄠㄡ",
                        symbols: ["ㄝ", "ㄞ", "ㄟ", "ㄠ", "ㄡ"],
                        symbolsA: ["c_25", "c_26", "c_27", "c_28", "c_29"],
                        words: {
                            "ㄝ": ["字", "自", "走", "坐"],
                            "ㄞ": ["從", "菜", "草", "次"],
                            "ㄟ": ["四", "三", "送", "絲"],
                            "ㄠ": ["四", "三", "送", "絲"],
                            "ㄡ": ["四", "三", "送", "絲"]
                        },
                        unlocked: false,
                        completed: false,
                        stars: 0
                    },
                    9: {
                        title: "第九關：ㄢㄣㄤㄥㄦㄧㄨㄩ",
                        symbols: ["ㄢ", "ㄣ", "ㄤ", "ㄥ", "ㄦ", "ㄧ", "ㄨ", "ㄩ"],
                        symbolsA: ["c_30", "c_31", "c_32", "c_33", "c_34", "c_35", "c_36", "c_37"],
                        words: {
                            "ㄢ": ["字", "自", "走", "坐"],
                            "ㄣ": ["從", "菜", "草", "次"],
                            "ㄤ": ["四", "三", "送", "絲"],
                            "ㄥ": ["四", "三", "送", "絲"],
                            "ㄦ": ["四", "三", "送", "絲"],
                            "ㄧ": ["四", "三", "送", "絲"],
                            "ㄨ": ["四", "三", "送", "絲"],
                            "ㄩ": ["四", "三", "送", "絲"]
                        },
                        unlocked: false,
                        completed: false,
                        stars: 0
                    }
                },
                currentQuestions: []    // 當前關卡的問題列表
            };

            // ==========================================
            //  DOM 元素存取
            // ==========================================
            const startScreen = document.getElementById('start-screen');
            const levelSelect = document.getElementById('level-select');
            const gameScreen = document.getElementById('game-screen');
            const levelComplete = document.getElementById('level-complete');
            const startButton = document.getElementById('start-button');
            const backToStart = document.getElementById('back-to-start');
            const backToLevels = document.getElementById('back-to-levels');
            const levelButtons = document.querySelectorAll('.level-button');
            const levelTitle = document.getElementById('level-title');
            const scoreDisplay = document.getElementById('score-display');
            const progressBar = document.getElementById('progress-bar');
            const playSound = document.getElementById('play-sound');
            const soundWave = document.getElementById('sound-wave');
            const currentSymbol = document.getElementById('current-symbol');
            const optionsContainer = document.getElementById('options-container');
            const feedbackArea = document.getElementById('feedback-area');
            const correctFeedback = document.getElementById('correct-feedback');
            const incorrectFeedback = document.getElementById('incorrect-feedback');
            const correctAnswer = document.getElementById('correct-answer');
            const finalScore = document.getElementById('final-score');
            const replayLevel = document.getElementById('replay-level');
            const nextLevel = document.getElementById('next-level');
            const levelStars = document.getElementById('level-stars');
            const resultStars = document.getElementById('result-stars');
            const guideSpeech = document.getElementById('guide-speech');
            const characterMouth = document.getElementById('character-mouth');

            // ==========================================
            //  事件監聽器
            // ==========================================
            startButton.addEventListener('click', showLevelSelect);
            backToStart.addEventListener('click', showStartScreen);
            backToLevels.addEventListener('click', showLevelSelect);
            replayLevel.addEventListener('click', () => startLevel(gameState.currentLevel));
            nextLevel.addEventListener('click', startNextLevel);
            playSound.addEventListener('click', playCurrentSound);

            levelButtons.forEach(button => {
                if (!button.classList.contains('locked')) {
                    button.addEventListener('click', () => {
                        const level = parseInt(button.getAttribute('data-level'));
                        startLevel(level);
                    });

                    // 關卡按鈕滑入/滑出時顯示提示訊息
                    button.addEventListener('mouseenter', () => {
                        const level = parseInt(button.getAttribute('data-level'));
                        showGuideSpeech(`第${level}關：聽聽${gameState.levels[level].title.split('：')[1]}的發音！`);
                    });
                    button.addEventListener('mouseleave', () => {
                        hideGuideSpeech();
                    });
                } else {
                    button.addEventListener('mouseenter', () => {
                        showGuideSpeech("這個關卡還沒解鎖哦！先完成前面的關卡吧！");
                    });
                    button.addEventListener('mouseleave', () => {
                        hideGuideSpeech();
                    });
                }
            });

            // ==========================================
            //  核心遊戲功能函數
            // ==========================================

            /**
             * 顯示開始畫面
             */
            function showStartScreen() {
                startScreen.classList.remove('hidden');
                levelSelect.classList.add('hidden');
                gameScreen.classList.add('hidden');
                levelComplete.classList.add('hidden');
            }

            /**
             * 顯示關卡選擇畫面，並更新關卡按鈕狀態
             */
            function showLevelSelect() {
                startScreen.classList.add('hidden');
                levelSelect.classList.remove('hidden');
                gameScreen.classList.add('hidden');
                levelComplete.classList.add('hidden');
                updateLevelButtons();
            }

            /**
             * 根據遊戲進度更新關卡按鈕的鎖定狀態與星星數
             */
            function updateLevelButtons() {
                levelButtons.forEach(button => {
                    const level = parseInt(button.getAttribute('data-level'));
                    const levelData = gameState.levels[level];

                    if (levelData.unlocked) {
                        button.classList.remove('locked');

                        // 更新星星顯示
                        const stars = button.querySelectorAll('.star');
                        for (let i = 0; i < stars.length; i++) {
                            if (i < levelData.stars) {
                                stars[i].classList.add('earned');
                            } else {
                                stars[i].classList.remove('earned');
                            }
                        }
                    }
                });
            }

            /**
             * 顯示角色引導對話框
             * @param {string} text - 要顯示的訊息
             */
            function showGuideSpeech(text) {
                guideSpeech.textContent = text;
                guideSpeech.style.opacity = '1';
            }

            /**
             * 隱藏角色引導對話框
             */
            function hideGuideSpeech() {
                guideSpeech.style.opacity = '0';
            }

            /**
             * 開始一個新的關卡
             * @param {number} level - 關卡編號
             */
            function startLevel(level) {
                gameState.currentLevel = level;
                gameState.score = 0;
                gameState.progress = 0;
                gameState.currentQuestion = 0;
                gameState.correctAnswers = 0;

                // 產生本關卡的問題
                generateQuestions(level);

                // 更新遊戲介面顯示
                levelTitle.textContent = gameState.levels[level].title;
                scoreDisplay.textContent = gameState.score;
                progressBar.style.width = '0%';

                // 顯示遊戲畫面
                startScreen.classList.add('hidden');
                levelSelect.classList.add('hidden');
                gameScreen.classList.remove('hidden');
                levelComplete.classList.add('hidden');

                // 顯示第一個問題
                showQuestion();
            }

            /**
             * 為當前關卡生成隨機問題列表
             * @param {number} level - 關卡編號
             */
            function generateQuestions(level) {
                const levelData = gameState.levels[level];
                gameState.currentQuestions = [];

                // 產生總題數的問題
                for (let i = 0; i < gameState.totalQuestions; i++) {
                    const randomSymbolIndex = Math.floor(Math.random() * levelData.symbols.length);
                    const symbol = levelData.symbols[randomSymbolIndex];
                    const symbolA = levelData.symbolsA[randomSymbolIndex];

                    gameState.currentQuestions.push({
                        symbol: symbol,
                        symbolA: symbolA,
                        options: getRandomOptions(levelData.symbols, symbol)
                    });
                }
                // 打亂問題順序
                shuffleArray(gameState.currentQuestions);
            }

            /**
             * 從所有符號中隨機選擇三個作為錯誤選項
             * @param {Array<string>} allSymbols - 所有注音符號
             * @param {string} correctSymbol - 正確的注音符號
             * @returns {Array<string>} - 包含一個正確答案和三個錯誤答案的陣列
             */
            function getRandomOptions(allSymbols, correctSymbol) {
                const options = [correctSymbol];
                const availableSymbols = allSymbols.filter(s => s !== correctSymbol);

                // 加入三個隨機的錯誤選項
                while (options.length < 4 && availableSymbols.length > 0) {
                    const randomIndex = Math.floor(Math.random() * availableSymbols.length);
                    options.push(availableSymbols[randomIndex]);
                    availableSymbols.splice(randomIndex, 1);
                }

                // 打亂選項順序
                shuffleArray(options);
                return options;
            }

            /**
             * 顯示當前問題的選項
             */
            function showQuestion() {
                if (gameState.currentQuestion >= gameState.totalQuestions) {
                    // 如果所有問題都回答完畢，則完成關卡
                    completeLevel();
                    return;
                }

                const question = gameState.currentQuestions[gameState.currentQuestion];
                gameState.currentSymbol = question.symbol;

                // 隱藏回饋訊息
                feedbackArea.classList.add('hidden');
                correctFeedback.classList.add('hidden');
                incorrectFeedback.classList.add('hidden');

                // 隱藏聲波
                //soundWave.classList.add('hidden');
                currentSymbol.classList.add('hidden');

                // 動態生成選項按鈕
                optionsContainer.innerHTML = '';
                question.options.forEach((option) => {
                    const button = document.createElement('div');
                    button.className = 'symbol-card bg-white rounded-xl p-4 shadow-md text-center';
                    button.innerHTML = `<span class="text-4xl font-bold">${option}</span>`;
                    button.addEventListener('click', () => checkAnswer(option));
                    optionsContainer.appendChild(button);
                });
            }

            /**
             * 播放當前問題的聲音
             */
            function playCurrentSound() {
                if (gameState.isPlaying) return;

                gameState.isPlaying = true;

                // 顯示聲波並觸發角色嘴巴動畫
                //soundWave.classList.remove('hidden');
                characterMouth.classList.add('speaking');
                const questionA = gameState.currentQuestions[gameState.currentQuestion];
                document.getElementById(questionA.symbolA).play();

                // 模擬聲音播放結束
                setTimeout(() => {
                    gameState.isPlaying = false;
                    //soundWave.classList.add('hidden');
                    characterMouth.classList.remove('speaking');
                }, 2000);
            }

            /**
             * 檢查使用者選擇的答案是否正確
             * @param {string} selectedOption - 使用者選擇的注音符號
             */
            function checkAnswer(selectedOption) {
                const isCorrect = selectedOption === gameState.currentSymbol;

                // 找到使用者點擊的卡片
                const buttons = optionsContainer.querySelectorAll('.symbol-card');
                let selectedButton;
                buttons.forEach(button => {
                    if (button.textContent.trim() === selectedOption) {
                        selectedButton = button;
                    }
                });

                if (isCorrect) {
                    // 答對邏輯
                    selectedButton.classList.add('correct');
                    gameState.score += 10;
                    gameState.correctAnswers++;
                    scoreDisplay.textContent = gameState.score;
                    feedbackArea.classList.remove('hidden');
                    correctFeedback.classList.remove('hidden');
                    createConfetti(); // 答對時產生紙屑
                } else {
                    // 答錯邏輯
                    selectedButton.classList.add('incorrect');
                    feedbackArea.classList.remove('hidden');
                    incorrectFeedback.classList.remove('hidden');
                    correctAnswer.textContent = gameState.currentSymbol;
                }

                // 禁用所有選項按鈕，防止重複點擊
                buttons.forEach(button => {
                    button.style.pointerEvents = 'none';
                });

                // 延遲一段時間後進入下一題
                setTimeout(() => {
                    gameState.currentQuestion++;
                    gameState.progress = (gameState.currentQuestion / gameState.totalQuestions) * 100;
                    progressBar.style.width = `${gameState.progress}%`;
                    showQuestion();
                }, 2000);
            }

            /**
             * 完成關卡，計算分數與星星
             */
            function completeLevel() {
                // 根據正確率計算星星數
                const percentage = (gameState.correctAnswers / gameState.totalQuestions) * 100;
                let stars = 0;
                if (percentage >= 90) {
                    stars = 3;
                } else if (percentage >= 70) {
                    stars = 2;
                } else if (percentage >= 50) {
                    stars = 1;
                }

                // 更新關卡數據
                gameState.levels[gameState.currentLevel].completed = true;
                // 僅在獲得更多星星時更新記錄
                gameState.levels[gameState.currentLevel].stars = Math.max(stars, gameState.levels[gameState.currentLevel].stars);

                // 解鎖下一關
                if (gameState.currentLevel < Object.keys(gameState.levels).length) {
                    gameState.levels[gameState.currentLevel + 1].unlocked = true;
                }

                // 更新完成畫面的UI
                finalScore.innerHTML = `你獲得了 <span class="font-bold text-indigo-700">${gameState.score}</span> 分！`;
                const resultStarsElements = resultStars.querySelectorAll('.star');
                for (let i = 0; i < resultStarsElements.length; i++) {
                    if (i < stars) {
                        resultStarsElements[i].classList.add('earned');
                    } else {
                        resultStarsElements[i].classList.remove('earned');
                    }
                }

                // 判斷是否隱藏「下一關」按鈕
                if (gameState.currentLevel >= Object.keys(gameState.levels).length) {
                    nextLevel.classList.add('hidden');
                } else {
                    nextLevel.classList.remove('hidden');
                }

                // 顯示關卡完成畫面並產生慶祝紙屑
                gameScreen.classList.add('hidden');
                levelComplete.classList.remove('hidden');
                createCelebrationConfetti();
            }

            /**
             * 進入下一關
             */
            function startNextLevel() {
                if (gameState.currentLevel < Object.keys(gameState.levels).length) {
                    startLevel(gameState.currentLevel + 1);
                } else {
                    showLevelSelect();
                }
            }

            /**
             * 產生少量紙屑效果
             */
            function createConfetti() {
                const confettiCount = 30;
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.animation = `fall ${1 + Math.random() * 2}s linear forwards`;
                    document.getElementById('game-container').appendChild(confetti);
                    setTimeout(() => { confetti.remove(); }, 3000);
                }
            }

            /**
             * 產生大量紙屑效果（關卡完成時使用）
             */
            function createCelebrationConfetti() {
                const confettiCount = 100;
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.animation = `fall ${1 + Math.random() * 3}s linear forwards`;
                    document.getElementById('game-container').appendChild(confetti);
                    setTimeout(() => { confetti.remove(); }, 4000);
                }
            }

            // ==========================================
            //  通用工具函數
            // ==========================================

            /**
             * 打亂陣列順序
             * @param {Array<any>} array - 要打亂的陣列
             * @returns {Array<any>} - 已打亂的陣列
             */
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // ==========================================
            //  遊戲初始化
            // ==========================================
            showStartScreen();
        });
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9353f54a23896a80',t:'MTc0NTQ4MDQ4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>
</html>
